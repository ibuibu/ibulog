---
title: "Jestにコントリビュートした"
date: "2022-11-10"
icon: "👨‍🎓"
tags: ["Jest"]
---

先日、筆者がコントリビュートしたJestのv29.3.0がリリースされた。

[https://github.com/facebook/jest/releases/tag/v29.3.0](https://github.com/facebook/jest/releases/tag/v29.3.0)

Jestは直近の週間DL数が2千万、累計8億件以上もある、JavaScriptのテストフレームワークでシェアNo.1の代物だ。初めてのOSS活動で、いきなり超有名なライブラリにコントリビュートできて、正直びっくりした。

以下、経緯を振り返る。

## 経緯

もうすぐ長期の育児休暇に入るため、コーディングスキルの衰えを防ぐためにOSS活動を初めてみようかと思い立った。「OSS活動 やり方」と検索すると、`good first issue`なるlabelでissueを検索してチャレンジするのがよい、という勧めが多かった。早速、`good first issue`のまとめサイトである[goodfirstissue](https://goodfirstissue.dev/)で検索し、毎日使っているJestに5件ほどのissueが見つかった。

その中でまず着手したのが、こちらの[issue](https://github.com/facebook/jest/issues/12556)。 3月に起案されたもので、ドキュメント上のWebpackのチュートリアルが古すぎる、という内容だった。ドラフトのPRが7月に作られていたが、コメントが放置されていた。これは誰でもできるただのめんどくさい作業なので、入門にちょうどよいと考え、2h程度で[PR](https://github.com/facebook/jest/pull/13556) を作成した。（lint漏れでメンテナが直してくれてた。ありがたや。）

次に着手したのが、こちらの[issue](https://github.com/facebook/jest/issues/9761)。4月に起案されたもので、configの`projects`の中身のバリデーションが効いてない、というものだった。わかりやすいし再現もすぐできる事象なので、これならイケると思い、原因調査を開始した。割とすぐに対象箇所は見つかったが、`projects`の中身を覗いているとき、という判定がなかなか骨が折れた。というのも、`projects`は文字列で対象プロジェクトのpathの文字列か、その設定のオブジェクト、という２つのパタンを持つ配列型のプロパティだからだった。多くの使えそうな変数をひたすらprintしながら、文字列でもオブジェクトでも共通で使える条件式をなんとか特定できた。 判定さえできれば、あとはバリデーションに用いるオブジェクトを`projects`用の型のプロパティに絞ったものを作って渡すだけだった。

PR作成後、メンテナの方にnice!と言われたときはとても嬉しかった。メンテナのapproveの後、超細かい版のCIテストが走るのだが、windowsのテストでpathが`\`のためにコケてたので、急いで直した。その翌日マージされ、直後にv29.3.0がリリースされた。

しかし、実はv29.3.0のリリース直後に筆者の修正箇所にバグが見つかり、nice!と行ってくれたメンテナの型が速攻で修正してパッチversionをリリースしてくれていた。といっても筆者の修正自体にはミスはなく、用いた型定義にそもそもプロパティが足りていなかったことが問題であった。そのため、それが顕在化して修正されるきっかけを作ったという意味でプラスに捉えられる事態だと思う。

・・・ということで、初めてOSS活動をやってみたが、とてもいい経験だった。Jestはおそらく何億ものソフトのテストとして使われていて、そのユーザー数となれば想像もつかないほど多くの人数になるわけで、、、今回の貢献の効果を考えるととても感慨深い気持ちになる。

